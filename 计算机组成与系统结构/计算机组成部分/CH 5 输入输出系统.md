[TOC]
# CH 5 输入输出系统
**概述（接口与总线的分类与它们的概念）**
**模型机系统总线组成（总线仲裁）**
**直接程序传送方式与接口**
**中断方式及接口！**
**DMA方式及接口！**

## 概述

### 二、总线
#### 1、总线定义、特点和实体
1）定义：一组能为多个部件分时共享的信息传送线路。
2）特点：分时、共享
	 通常做法发送部件通过OC组件或三态门分时发送信息，由打入脉冲将信息送入指定接收部件。
3）实体：一组传送线与相应控制逻辑
#### 2、总线分类
（1）按功能划分
1）CPU内总线——ALU总线
CPU芯片内寄存器与运算逻辑部件之间互连的总线
单组数据线（单向、双向）或多组数据线，或多种总线。
2）部件内总线——局部总线、片级总线
3）系统总线——板级总线
4）外总线——通信总线
（2）按时序控制方式划分
1）同步总线
由**同一时序**控制总线传送操作。
2）异步总线
3）扩展同步总线
**注意几个“周期”概念：**
**时钟周期：** CPU一步操作（一次内部数据通路传送）时间。
**总线周期：** 经过总线的一次数据传送（访存）时间。
							通常包含若干时钟周期（模型机的一个总线周期只包含一个时钟周期）
**工作周期：** 指令周期中的一个操作阶段。可包含多个总线周期。

第一节	接口类型与功能
I/O接口指**主机**和**外设**的交接部分，位于**系统总线**

## 5.4 中断方式及接口
1.中断基本概念
2.中断全过程（外中断）
3.优先权逻辑与屏蔽技术
4.服务程序入口地址的获取方式
5.中断处理
6.中断接口

### 5.3.1 中断基本概念

#### 1.定义
CPU**暂时停止**现行程序的执行，**转去**执行为某个随机事态服务的**中断处理程序**。处理完毕后自动**恢复**原程序的执行。
#### 2.实质与特点
（1）实质
程序切换：
方法：保存断点，保护现场
			恢复现场，返回断点
时间：一条指令结束时切换。
			保证程序完整性。
（4）向量中断与非向量中断
向量中断：由硬件提供服务程序入口地址
非向量中断：由软件提供服务程序入口地址

#### 4.中断典型应用
（1）管理**中、低速**I/O操作

（2）

### 5.3.2 中断全过程（外中断）
#### 1.中断请求的**提出**与**传递**

##### （1）如何产生中断请求？

外设工作完成：“完成”标志为1
CPU允许请求：“屏蔽”标志为0

##### （2）如何传送中断请求？

1）使用单独请求线

2）使用公共请求线

#### 2.中断判优（8259的原理）

##### （1）优先顺序

故障、DMA、外中断（输入、输出）

##### （2）CPU现行程序与外设请求的判优

1）CPU设置允许中断标志：`1`开中断，`0`关中断

2）硬件判优

中断请求$\to$8259（未屏蔽的请求判优，生成相应的中断号）$\to$公共请求INT$\to$CPU

#### 3.中断响应（响应的条件）

#### （1）相应条件（外中断）

外设有请求，且未被屏蔽；CPU开中断；一条指令（非停机指令）结束；无故障、DMA等优先级更高的请求。

##### （2）如何获取中断服务程序的入口地址

1）非向量中断

将服务程序入口组织在查询程序中；CPU响应时执行查询程序，查询中断源，转入相应服务程序。

2）向量中断

将服务程序入口（**中断向量**）组织在**中断向量表**中；CPU响应时由硬件直接产生响应**向量地址**，按地址查表，取得服务程序入口，转入相应服务程序。

**中断向量**：服务程序入口地址、服务程序状态字

**中断向量表**：存放**中断向量**的表（一段存储区）

**向量地址**：访问向量表的地址（指向中断向量的首址）

##### （3）响应过程（响应的工作过程）

向量中断方式（CPU执行中断隐指令）：发响应信号INTA，进入中断周期$\to$关中断，保存断点$\to$获得中断信号，转换为向量地址，查向量表$\to$取中断向量，转中断服务程序

#### 4.中断处理（单级，多重）

**CPU执行中断服务程序**

##### （1）单级中断：CPU响应后只处理一个中断源的请求，处理完毕后才能响应新的请求

保护现场

具体服务处理（外中断：数据传送）

恢复现场

开中断、返回

##### （2）多重中断：在某次中断服务过程中，允许响应处理更高级别的中断请求

保护现场

送新屏蔽字（禁止同级或更低级别的请求，开放更高级别的请求）、开中断

具体服务处理

关中断

恢复现场及原屏蔽字

开中断、返回

### 5.3.3 中断接口

#### 1.组成（寄存器级）

#### 2.工作流程（外中断）

##### （1）初始化：设置工作方式，送屏蔽字，送中断信号

##### （2）发启动命令（送命令字），启动设备

##### （3）设备完成工作，申请中断

##### （4）终端控制器汇集各请求，经屏蔽、判优，形成中断号，并向CPU送INT

##### （5）CPU响应，发批准INTA

#### 3.DMA方式

**直接**依靠**硬件**在主存与I/O设备间进行直接的数据传递，在传递期**不需**CPU干预。

DMA方式本身只能处理简单的数据传递，不切换程序

三个阶段：

程序准备：CPU用程序实现初始化信息

DMA传送：DMA控制器掌握总线权，控制传送

善后处理：CPU执行中断程序作结束处理

##### （2）硬件设置

##### （3）DMA流程

