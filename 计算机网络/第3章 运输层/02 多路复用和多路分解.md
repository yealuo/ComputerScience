# 多路复用/多路分解
## 在发送主机多路复用：
从多个套接字收集数据, 用首部封装数据，然后将报文段传递到网络层。
## 在接收主机多路分解：
使用头部信息将接收到的报文段传递到正确的套接字。
## 多路分解如何工作?
主机收到IP数据报
- 每个数据报有**源IP地址、目的IP地址**
- 每个数据报搬运一个运输层报文段
- 每个数据段有**源、目的端口号**（回忆: 对于特定应用程序具有周知端口号)
主机用**IP地址和端口号**指明报文段属于哪个合适的套接字
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303301955176.png)
### 无连接多路分解
UDP套接字由**二元组**标识: 
- 目的IP地址
- 目的端口号
当创建套接字时，必须指定本地主机的端口号：
$DatagramSocket mySocket1 = new DatagramSocket(12534);$
当创建数据报发送到UDP套接字时，必须指定：
- 目的 IP 地址
- 目的端口号
当接收主机接收UDP报文段时:
- 检查报文段中的目的端口号
- 用端口号指示UDP报文段属于哪个套接字
>具有**相同目的端口号**，但不同源 IP地址和/或源端口号 的IP/UDP数据报，在目的端将指向相同的套接字
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303302008246.png)
### 面向连接的多路分解
TCP套接字由**四元组**标识: 
- 源IP地址
- 源端口号
- 目的IP地址
- 目的端口号
多路复用：接收主机使用这**四个值**来将报文段定位到适当的套接字
服务器主机可同时支持多个TCP套接字：
- 每个套接字由其自己的四元组标识
- 每个套接字关联到一个不同的客户
以Web服务器为例：对每个连接的客户都有不同的套接字
- 非持续 HTTP 对每个请求有一个不同的套接字
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303302008331.png)
# 多路复用和多路分解小结
多路复用、多路分解：基于报文段、数据报头部字段值
[[#无连接多路分解|UDP]]：仅使用目的端口号进行多路分解
[[#面向连接的多路分解|TCP]]：使用四元组进行多路分解：源、目的IP地址及端口号
多路复用/多路分解发生在**所有层**

# 两大类端口
**服务器端使用的端口号**
1. **熟知端口**，数值一般为 0 ~ 1023。 ^3d5c7b
2. **登记端口**，数值为 1024 ~ 49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复。
**客户端使用的端口号**
1. **又称为短暂端口号**，数值为 49152 ~ 65535，留给客户进程选择暂时使用。
2. 当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号。通信结束后，这个端口号可供其他客户进程以后使用。 
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303302119306.png)
