# 1.3.1 网络核心部分
相互连接的路由器构成的网络,如何在这个网络中传送数据？
基本原理：
- **电路交换：** 每次会话预留沿其路径（线路）所需的独占资源——电话网
- **分组交换：** 数据以离散的数据块通过网络来发送
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152201267.png)
## 1. 电路交换
网络资源（如带宽）被分片
**多路复用（Multiple Access）**
- 分片分配到会话
- 分片没有被会话使用的情况下，分片空载(不共享)
- 电路级性能（有保证）
- 要求呼叫建立——建立一个专门的端到端线路 (意味着每个链路上预留一个线路)
- 链路带宽分片
	- ==频分FDM－frequency division multiplexing==, 按频率划分若干==频段==，每个频段专用于一个连接
	- ==时分TDM－time division multiplexing==, 时间划分为固定区间的==帧==，每帧再划分为固定数量的==时隙==，每一个时隙专用于一个连接，用于传输数据。
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152211414.png)
### 电路交换网络
- **每个链路可有n 条电路**，能够支持 n 条同步连接。 
- **通信过程：** 在两台主机A、B之间创建一条**专用的端到端连接**，分别占用每条链路中的一条电路；该连接获得链路带宽的1/n，进行通信。
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152216560.png)
### 电路交换举例
**从主机A到主机B经一个电路交换网络需要多长时间发送一个640Kb的文件?**
**假设：**
   所有链路都是 1.536 Mbps
   每个链路使用TDM划分成24个时隙
   创建一条端到端的链路需要500msec

解:     
$$
\begin{array}{l}
\boldsymbol{发送一个文件时间 = 创建电路时间 + 文件传输时间}\\
文件传输时间：文件长/电路的传输速率\\
每条电路的传输速率：链路传输速率/时隙数\\
(1.536M b/s) / 24 = 64kb/s\\
文件传输时间：640kb/(64kb/s) = 10s\\
A 到 B 的总发送时间：0.5s + 10s = 10.5s
\end{array}
$$
## 2.分组交换
每个端到端的数据流被划分成分组
- 所有分组**共享**网络资源 
- 每个分组**使用全部链路带宽**
- 资源**按需**使用 
### 分组交换两个关键的网络核心功能
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152259865.png)
### 主机：发送分组
**主机发送功能：**
- 首先接收应用层消息
- 然后将其分解为较小的块，成为**分组(packets)**，设为 L bits
- 以**传输速率( transmission rate )** R bits/sec 发送到接入网
	- 链路传输速率，即**链路容量( link capacity )**，或**链路带宽( link bandwidth )**
$$分组传输时延=在链路中传输 L-bit分组的时间=\frac{L (bits)}{R (bits/sec)}$$
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152309074.png)
### 分组交换 - 存储转发 (store-and-forward) 
- 分组传输时延：将 L 比特的分组传输（推出）到速率为 R bps的链路需要花费 L/R s
- 存储转发：整个分组必须都到达路由器后才能传输到下一段链路
- 端到端时延 = 2 L/R （假定零传播时延）
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152342026.png)
### 分组交换 - 统计复用
A & B 分组没有固定的顺序——统计复用。
在时分复用中，每个主机获得各TDM循环帧的固定时隙。
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152343028.png)
### 分组交换 - 资源竞争
**资源竞争:**
- ==资源需求总量可以大于可获得资源的总量==
- **拥塞：** 采用分组队列，等待使用链路
- **存储转发：** 
- 分组每次转发1站
- 在1个链路上传输
- 每经过1个链路转发1次
- 转发分组前，要求收到完整分组
### 分组交换 – 排队
**分组排队及丢失：** 如果某段时间内，链路上分组到达速率（bps）大于传输速率（bps）：
- 分组将**排队**，等待在出链路上发送
- 如果路由器缓存空间已满，分组会被**丢弃**
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303152350516.png)
## 比较分组交换与电路交换
**分组交换允许更多的用户使用网络 !**
假设：
- 用户共享1 Mbps 的链路
- 每个用户: 
	- 活动期传输率100 kbps
	- 只有10%的时间活动
**电路交换：**
- 10 users
**分组交换：**
- 如果35个用户
- 10个以上活动用户 ( ≥ 11 ) 并发的概率小于 0 .0004；当有 10 个或更少的并发用户时（以概率0.9996发生），达到的聚合数据速率 ≤ 1Mbps 
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303160017462.png)
#提问
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303160004939.png)
### 电路交换的主要特点
**优点:**
- 电路交换通常采用**面向连接方式**
- ==先呼叫建立连接==，实现端到端的==资源预留==
- **预留的资源**包括：链路带宽资源、交换机的交换能力
- 电路交换连接建立后，物理通路被通信双方**独占，资源专用**，即使空闲也不与其他连接共享
- 由于建立连接并预留资源，因此传输性能好；但如果传输中发生设备故障，则传输被中断
- **缺点:**
- ==无法应对互联网中广泛存在的“突发”（Burst）流量==
### 分组交换的主要特点
**优点:**
- 将**大报文拆分成多个小分组**
- 通信双方以==分组==为单位、使用==存储--- 转发机制==，实现数据交互的通信方式
- **以分组作为数据传输单元**
- 每个分组的**首部都含有地址**（目的地址和源地址）等控制信息
- 每个分组在互联网中==独立地选择传输路径==
- 支持灵活的==统计多路复用==
- **适合大量的突发数据传输**
- 资源共享
- 简单, 不需要建立连接
**缺点:**
- **过度竞争导致分组延迟与丢失**
- 需要可靠数据传输、拥塞控制协议

## 典型交换方式的比较
### 三种交换的比较
- 电路交换需要建立连接并预留资源，难以实现灵活复用
- 报文交换和分组交换较灵活，抗毁性高，在传送**突发数据**时可提高网络利用率
- 由于分组长度小于报文长度，分组交换比报文交换的**时延小**，也具有更好的**灵活性**
- **分组交换适合有大量突发数据传输需求的互联网**
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303160022881.png)
## 分组交换网络的分类
**数据报网络: TCP/IP**
- 分组目的地址决定下一跳
- 会话期间路由可以改变
- 比方：驱车逐段问路 
**虚电路网络: X.25, FR, ATM**
- 每个分组有1个标签  (虚电路号VCID，virtual circuit ID)，标签决定下1跳
- 连接建立时确定固定的路径，并且将保持于整个会话期间
- 路由器必须为每个连接维护状态信息
## 网络的分类
- **虚电路网络一定是面向连接的。** 
- **数据报网络既可以提供面向连接的服务也可以提供无连接的服务。** 如：Internet为网络应用既提供面向连接的传输服务 (TCP)，也提供无连接的传输服务(UDP)。
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202303160045554.png)
