# IP 数据报格式（IPv4）
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231717826.png)
# IP 数据报
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231718756.png)
版本——占 4 位，指 IP 协议的版本，目前的 IP 协议版本号为 4 (即 IPv4)。
首部长度——占 4 位，可表示的最大数值是 15 个单位(一个单位为 4 字节)，==因此 IP 的首部长度的最大值是 60 字节。==
服 务 类 型——占 8 位，用来获得更好的服务。在旧标准中叫做服务类型，但实际上一直未被使用过。1998 年这个字段改名为区分服务。只有在使用区分服务（DiffServ）时，这个字段才起作用。在一般的情况下都不使用这个字段 
总长度——占 16 位，指首部和数据之和的长度，单位为字节，因此数据报的最大长度为 65535 字节。==总长度必须不超过最大传送单元 [[05 面向连接的传输——TCP#^994bfa|MTU]]。== 
标识(identification) 占 16 位，它是一个计数器，用来产生数据报的标识。 
标志(flag) 占 3 位，目前只有两位有意义。第1位：保留，一般置为0。第2位：“不分片位”，DF (Don't Fragment) 。只有当 DF = 0 时才允许分片。 第3位：“更多片位”，MF (More Fragment)。MF = 1 表示后面“还有分片”。MF = 0 表示最后一个分片。
片偏移(13 位)指出：较长的分组在分片后，某片在原分组中的相对位置。==片偏移以 8 个字节为偏移单位。==
生存时间(8 位)记为 TTL (Time To Live)，数据报在网络中可通过的路由器数的最大值。==数据报每经过一台路由器，TTL值减1。若TTL=0，则该数据报必须丢弃。==
上层协议(8位)字段：指出此数据报携带的数据使用何种协议，以便目的主机的 IP 层将数据部分上交给哪个处理过程
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231727472.png)
首部检验和(16 位)字段只检验数据报的首部不检验数据部分。这里不采用 CRC 检验码而采用简单的计算方法。 
**为什么TCP/IP在运输层/网络层都执行差错检测？**
	1. 两者校验和计算的内容不同。IP层只对IP首部计算了校验和，而TCP/UDP对整个TCP/UDP报文段进行了校验和计算。
	2. TCP/UDP和IP不一定属于同一个协议栈。TCP能够运行在其他的协议上（比如ATM，IPX, Apple Talk DDP等），IP携带的数据也不一定必须要传递给TCP/UDP（传输层还有SCTP等协议）。
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231732217.png)
源IP地址和目的IP地址都各占 4 字节
# IP数据报分片和重组
每个数据链路有自己的MTU，链路类型不同，MTU的值也不同，这里MTU指的是数据链路层帧的数据区的最大字节数
在因特网中，一个大的分组可能在路由器中被分割为几个分片，在最终的目的主机上，将这些分片重新组装成一个大的分组
为了进一步识别出这些分组，需要对分片进行标识
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231740951.png)
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231743361.png)
由于 4000 byte datagram，数据部分为 3980 字节。
链路层 MTU 为 1500 字节，即 网络层的数据报总长度（数据+首部）=1500 字节，网络层数据部分最大为 1480 字节。

强调偏移量指数据载荷从 0字节 开始
第一片：0              ~ 1479字节；（第一片数据 1480字节）
第二片：1480字节 ~ 2959字节；（第二片数据 1480字节）
第三片：2960字节 ~ 3980字节。（第三片数据 1020字节）

![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231747844.png)
第二个局域网所能传送的最长数据帧中的数据部分只有1200bit，即
	每个IP数据报的数据部分 <= 1200 – 160 = 1040 bit
由于片偏移是以8字节即64 bit为单位，所以IP数据片的数据部分最大不超过1024 bit （1024是小于1040的最大的能被64整除的数，1040/64 = 16.25，取整得到16就是第二片偏移量；16\*64 = 1024）。
这样3200bit的报文要分4个数据片，所以第二个局域网向上传送的比特数等于（3200+4×160），共3840 bit。

每一片的最大数据报总长度（数据+首部）= 1024 + 160 = 1184 bit
运输层 3200 bit，则网络层的数据部分为 3200 bit。
分片1数据部分：0       ~ 1023
分片2数据部分：1024 ~ 2047
分片3数据部分：2048 ~ 3071
分片4数据部分：3072 ~ 3200
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231756866.png)
都有可能。因为源主机和中间路由器可能运行在不同的链路层协议之上，使得链路层帧所能承载的最大数据量（MTU，最大传输单元）不同，比如以太网 MTU = 1500 Bytes，PPPOE MTU = 1492 Bytes，而广域网链路的帧可承载的数据一般不超过 576 Bytes。
==注意：分片后的数据重新组装只在目的端的IP层。==
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231757402.png)
IP分片只针对UDP（以及ICMP）。对于TCP报文段，不会产生IP分片，因为一旦TCP数据过大，比如超过了MSS，传输层会对TCP报文段进行分段。
==注意：IP分片只有第一个片段带有传输层或ICMP首部，其余的片段只有IP头。==
**避免IP分片**
在网络编程中，我们要避免出现IP分片，那么为什么要避免呢？原因是IP层是没有超时重传机制的，如果IP层对一个数据包进行了分片，只要有一个分片丢失了，只能依赖于传输层进行重传，结果是所有的分片都要重传一遍，这个代价有点大。由此可见，IP分片会大大降低传输层传送数据的成功率，所以我们要避免IP分片。
对于UDP包，我们需要在应用层去限制每个包的大小，一般不要超过1472字节，即以太网MTU（1500）—UDP首部（8）—IP首部（20）。
对于TCP数据，应用层就不需要考虑这个问题了，因为传输层已经帮我们做了。在建立连接的三次握手的过程中，连接双方会相互通告MSS（Maximum Segment Size，最大报文段长度），MSS一般是MTU—IP首部（20）—TCP首部（20），每次发送的TCP数据都不会超过双方MSS的最小值，所以就保证了IP数据报不会超过MTU，避免了IP分片。
# IP地址
IP 地址: 分配给主机或路由器接口的标识符
接口: 主机/路由器与物理链路之间的边界
- 路由器有多个接口
- 主机可以有多个接口
- 每个接口有一个IP地址
IP地址有两种：IPV4和IPV6
- IPV4：32个二进制位长（4字节），常用点分十进制表示
- IPV6：128个二进制位长（16字节）常用冒号分隔表示
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231805629.png)
# IP 地址的编址方法 
**分类的IP地址**。这是==最基本的编址方法==，在 1981 年就通过了相应的标准协议。
**子网的划分**。这是对最基本的编址方法的==改进==，其标准[RFC 950]在 1985 年通过。
**CIDR构成超网**。这是比较新的==无分类编址方法== (CIDR)。1993 年提出后很快就得到推广应用。
# IPv4编址
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231808568.png)
## 1. 分类 IP 地址 
每一类地址都由两个固定长度的字段组成，其中一个字段是**网络号 net-id**，它标志主机（或路由器）所连接到的网络，而另一个字段则是**主机号 host-id**，它标志该主机（或路由器）。
两级的 IP 地址可以记为：
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231814402.png)
### 传统的IP地址分类
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231815480.png)
### 特殊IP地址段
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231821798.png)
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231822354.png)
### 特殊IP地址
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306231826225.png)
### IP 地址的一些重要特点 
**(1) IP地址是一种分等级的地址结构。分两个等级的好处是：**
1. IP 地址管理机构在分配 IP 地址时只分配网络号，而剩下的主机号则由得到该网络号的单位自行分配。这样就方便了 IP 地址的管理。
2. 路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目的主机号），这样就可以使路由表中的项目数大幅度减少，从而减小了路由表所占的存储空间。
**(2) 实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口。**
- 当一个主机同时连接到两个网络上时，该主机就必须同时具有两个相应的 IP 地址，其网络号 net-id 必须是不同的。这种主机称为多归属主机(multihomed host)。
- 由于一个路由器至少应当连接到两个网络（这样它才能将 IP 数据报从一个网络转发到另一个网络），因此一个路由器至少应当有两个不同的 IP 地址。  
**(3) 用转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都具有同样的网络号 net-id。**
**(4) 所有分配到网络号 net-id 的网络，无论是范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是平等的**。
## 2. 子网的划分
**（1）从两级 IP 地址到三级 IP 地址**
在 ARPANET的早期，IP地址的设计确实不够合理。
IP 地址空间的利用率有时很低。 
给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。 
两级的 IP 地址不够灵活。  
**（2）三级的 IP 地址**
从 1985 年起在 IP 地址中又增加了一个“子网号字段”，使两级的 IP 地址变成为三级的 IP 地址。
这种做法叫作==划分子网==(subnetting) 。划分子网已成为因特网的正式标准协议。 
### 划分子网的基本思路 
划分子网纯属一个==单位内部的事情==。单位对外仍然表现为没有划分子网的网络。
**从主机号借用若干个位作为子网号 subnet-id**，而主机号 host-id 也就相应减少了若干个位。
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241122153.png)
凡是从其他网络发送给本单位某个主机的 IP 数据报，仍然是根据 IP 数据报的==目的网络号== net-id，先找到连接在==本单位网络上的路由器==。
然后==此路由器==在收到 IP 数据报后，再按目的网络号 net-id 和子网号 subnet-id 找到目的子网。
最后就将 IP 数据报直接交付目的主机。 
### 子网掩码
当没有划分子网时，IP 地址是两级结构。
划分子网后 IP 地址就变成了**三级结构**。
**划分子网只是把 IP 地址的主机号 host-id 这部分进行再划分，而不改变 IP 地址原来的网络号 net-id**。 
从一个 IP 数据报的首部并==无法判断==源主机或目的主机所连接的网络是否进行了子网划分。
使用 **子网掩码(subnet mask)** 可以找出 IP 地址中的子网部分。  
### IP 地址的各字段和子网掩码 
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241126906.png)
### (IP 地址) AND (子网掩码) = 网络地址
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241127494.png)
### 默认子网掩码
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241128424.png)
### 子网
**什么是一个子网 ?**
从IP地址的观点来看：
- 设备接口的IP地址具有同样的网络部分
- 没有路由器的介入，物理上能够相互到达
**定义子网的方法：**
- 将每个接口与其主机或路由器分离，创建隔离网络的“孤岛”
- 每个隔离的网络称为一个子网
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241131635.png)
**【例】已知 IP 地址是 141.14.72.24，子网掩码是 255.255.192.0。试求网络地址。**
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241132174.png)
**【例】在上例中，若子网掩码改为255.255.224.0。试求网络地址，讨论所得结果。**
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241133956.png)
### 例子：子网划分
例：现有一个C类网 202.114.1.1－202.114.1.254，
**（1）请写出怎样将这个C类网划分为2个、6个、14个子网；
（2）假设这些IP用于某公司。现公司任一部门，最多有30台机器，问应该怎样划分子网？如果有49台机器又将怎样划分？
对(1)、(2)，请写出子网所需要的位数、子网掩码和子网号。**
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241145570.png)
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241145992.png)
>RFC950参考规定：第一个子网（也就是“全0子网”）和最后一个子网（也就是“全1子网”）不可用，为的就是避免全0子网的网络地址和全1子网的广播地址分别与没有划分子网前的网络地址和广播地址相冲突。
  但是在后来RFC1878规定中，该项规定已被废止了，现在的设备基本上都普遍支持RFC1878。
### 使用子网掩码的分组转发
不划分子网时，路由表只有两项：目的网络地址和下一跳地址，例如：
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241148574.png)
### 使用子网掩码的分组转发
使用子网划分后，路由表中将包括三项：**目的网络地址、子网掩码和下一跳地址**，例如：
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241151922.png)
## 3. 无分类编址 CIDR(Classless Inter-Domain Routing)
### CIDR 最主要的特点 
CIDR 消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，因而可以更加有效地分配 IPv4 的地址空间。
CIDR使用各种长度的“**网络前缀**”(network-prefix)来代替分类地址中的网络号和子网号。
IP 地址从三级编址（使用子网掩码）又回到了两级编址。  
### 无分类的两级编址 
无分类的两级编址的记法是：
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241419712.png)
CIDR 还使用“**斜线记法**”(slash notation)，它又称为**CIDR记法**，即在 IP 地址面加上一个斜线“/”，然后写上网络前缀所占的位数（这个数值对应于三级编址中子网掩码 1 的个数）。
CIDR 把网络前缀都相同的连续的 IP 地址组成“**CIDR 地址块**”。  
- 任意长地址的网络部分
- 地址格式：a.b.c.d/x，其中 x 是网络部分的比特长度
### CIDR 记法的其他形式 
10.0.0.0/10 可简写为 10/10，也就是把点分十进制中低位连续的 0 省略。
10.0.0.0/10 隐含地指出 IP 地址 10.0.0.0 的掩码是 255.192.0.0。此掩码可表示为
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241423414.png)
### CIDR 地址块 
128.14.32.0/20 表示的地址块共有 $2^{12}$ 个地址（因为**斜线后面的 20 是网络前缀的位数**，所以这个地址的主机号是 12 位）。
这个地址块的起始地址是 128.14.32.0。
在不需要指出地址块的起始地址时，也可将这样的地址块简称为“**/20 地址块**”。
128.14.32.0/20 地址块的最小地址：128.14.32.0
128.14.32.0/20 地址块的最大地址：128.14.47.255
在 CIDR 之前，**全 0 和全 1 的子网号，分别和主网络的网络地址和广播地址相重叠，一般不建议使用**；但 CIDR 之后，可以使用全 0 和全 1 的子网号（RFC 1878）（采用CIDR后，由于CIDR在路由时采取最长前缀匹配，目的地址192.168.0.255和地址块192.168.0.192/26的前缀匹配长度最长，所以广播发送到192.168.0.192/26地址块）
### 路由聚合(route aggregation) 
一个 CIDR 地址块可以表示很多地址，这种地址的聚合常称为**路由聚合**，它使得路由表中的一个项目可以表示很多个（例如上千个）原来传统分类地址的路由。
路由聚合也称为**构成超网**(supernetting)。
CIDR 虽然不使用子网了，但仍然使用“**掩码**”这一名词（但不叫子网掩码）。
**假设有16个C类网络，从 201.66.32.0 到 201.66.47.0，它们可以用掩码 255.255.240.0 统一表示为网络 201.66.32.0。**
### 构成超网 
前缀长度不超过 23 位的 CIDR 地址块都包含了多个 C 类地址。
这些 C 类地址合起来就构成了超网。
**CIDR 地址块中的地址数一定是 2 的整数次幂。**
网络前缀越短，其地址块所包含的地址数就越多。而在三级结构的IP地址中，划分子网是使网络前缀变长。  
**问题：由2048个C类网络组成，从192.24.0.0到192.31.255.0，哪个掩码可表示此地址范围**
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241442724.png)
### 子网划分及CIDR练习
**现有一公司已获得网络号为202.1.1.0/24，如果该公司有3个部门：
（1）如果第1个部门有60台计算机，第2个部门有20台计算机，第3个部门有16台计算机，问使用分类IP的子网划分方法如何分配地址?
（2）如果第1个部门有120台计算机，第2个部门有60台计算机，第3个部门有60台计算机，使用分类IP的子网划分方法可以分配地址吗？使用CIDR方法如何分配地址?**
（1）以最多台数的部门（60台）为准，需要的最接近数为2^6=64，故要从最后个字节借8-6=2位，
子网分别为 202.1.1.0, 202.1.1.64, 202.1.1.128, 202.1.1.192，在这4个其中任选3个即可。掩码均为255.255.255.192。
>注意：由于这里总共有4个子网，包含第一个全0子网和最后一个全1子网，如果不采用CIDR方法，实际本题无解：按照RFC 950，第一个全0子网的网络地址和最后一个全1子网的广播地址分别与没有划分子网前的网络地址和广播地址相冲突，不能使用，实际可以分配的子网只有 2 个；如果再借一位主机位，子网划分为 8 个，每个子网主机数又都只有30台，也不满足题中要求。

（2）若以最多台数的部门（120台）为准，仅能分两个子网，无法满足。故应采用CIDR法：
首先以最小需求台数部门为准（60台），此时主机号位数需要6位（因为60=<2^6），则子网号位数为8-6=2位，然后将子网划分出来。此时和（1）一样；
接下来，部门2、3可以直接在4个子网中任选两个，部门1选剩下2个以满足120台的要求（但这两个子网要连续，以便用CIDR法合并之，做超网）。比如：
部门1用：202.1.1.0、202.1.1.64   -> 需要进行路由聚合（构成超网）
部门2：202.1.1.128
部门3：202.1.1.192
最后将各部门IP段用CIDR超网形式描述，以便对外发布：
部门1：202.1.1.0/25; (注意含义：表示前25位是网络号，且最后一个字节最高位为0，后面7位是主机号)
部门2：202.1.1.128/26; (最后一个字节最高两位为10，后面6位是主机号)
部门3：202.1.1.192/26; (最后一个字节最高两位为11，后面6位是主机号)
说明：将202.1.1.128、202.1.1.192给部门1，202.1.1.0、202.1.1.64分别给部门2、3亦可。此时答案为：
部门2：202.1.1.0/26; 
部门3：202.1.1.64/26;
部门1：202.1.1.128/25
## IP地址: 怎样获取?
**主机如何得到IP地址?**
手工指定（保存在系统配置中）
DHCP: Dynamic Host Configuration Protocol
### 动态主机配置协议
plug-and-play（即插即用）
DHCP概述：
- 主机广播 DHCP DISCOVER 消息
- DHCP 服务器用 DHCP OFFER 消息响应
- 主机请求IP地址 DHCP REQUEST 消息
- DHCP 服务器确认 DHCP ACK/NACK 消息
- DHCP 终止租用期 DHCP RELEASE 消息
### DHCP 协议的工作过程 
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241503409.png)
⑨：DHCP 客户可随时提前终止服务器所提供的租用期，这时只需向 DHCP 服务器发送释放报文 DHCPRELEASE即可。
DHCP客户端启动时，由于其还未配置IP地址，因此只能使用广播方式发送DHCPDISCOVER包，即该数据包的源地址为 0.0.0.0，目标地址为 255.255.255.255
### DHCP:  不仅获得IP地址
DHCP分配的不仅仅是IP地址，还可分配：
- 客户的第一跳路由器的地址（网关）
- DNS服务器的IP地址或域名
- 子网掩码
**DHCP是应用层协议**
### 组织机构如何获取IP 地址？
Q: 怎样获取IP地址中的网络号部分？
A: 从ISP的地址空间中划分一块给申请者
例如：
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241512780.png)
## NAT: 网络地址转换
**动机: 对外部网络来讲，本地网络只用一个IP地址**
不需要从 ISP分配一系列地址—— 只要一个IP地址用于所有设备
在本地网络，改变设备的IP地址不用通知外部世界
可以变更 ISP ，不用改变本地网络的设备的地址
本地网络内部设备不能被外部世界明确寻址，或是不可见 (增加了安全性)
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241518371.png)
本地网络中的所有设备在“专用” IP地址空间（10 / 8、172.16 / 12、192.168 / 16）中具有32位地址，**这些地址只能在本地网络中使用**
**好处：**
- 供应商ISP只需为所有设备提供一个IP地址
- 可以在不通知外界的情况下更改本地网络中主机的地址
- 可以更改ISP而无需更改本地网络中设备的地址
- 安全性：本地网络中的设备不可直接寻址，外界不可见
**实现：NAT 路由器必须 (透明地)：**
**外出的分组**：替换每个外出的分组的 (源IP 地址, 端口号) 为 (NAT IP 地址, 新端口号) 
- 远程客户/服务器用(NAT IP地址, 新端口号)作为目的地来响应。
(在NAT转换表中) 记录每个(源IP 地址, 端口号)到 (NAT IP地址, 新端口号) 转换配对
**进来的分组**：对每个进来的分组，用保存在NAT表中的对应的 (源IP 地址, 端口号) 替换分组中的目的域 (NAT IP 地址, 新端口号）
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241529685.png)
# ICMP(Internet Control Message Protocol) 因特网控制报文协议
用于主机路由器之间彼此交流网络层信息
- 差错报告：不可到达的主机，网络、端口、协议
- 请求/应答 (用于ping, traceroute)
位于IP之上
- 因为ICMP消息是装载在IP分组里的
# IPv6编址
**初始动机：32-bit IPv4地址空间已全部耗尽。**
## IPv6首部
与 IP v4比较，IP v6： 
- **无首部长度**：IPv6 首部长度固定为 40 字节
- **无校验和**：全部去掉，减少每一跳的处理时间
- **无选项**（使得首部固定为40字节）：使用扩展首部来实现选项功能。
- 服务类型字段 TOS -> 流量类型 Traffic class
- 总长度 -> 有效载荷长度
- 协议字段 -> 下一个首部
- TTL 字段 -> 跳数限制
- **无分片/组装**
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241544180.png)
## IPv6地址表示
为了使地址再稍简洁些，IPv6 使用**冒号十六进制记法**
每个 16 位的值用十六进制值表示，各值之间用冒号分隔。例如：
$$68E6:8C64:FFFF:FFFF:0:1180:960A:FFFF$$
**在十六进制记法中，允许把数字前面的 0 省略。例如把 0000 中的前三个 0 省略，写成 1 个 0。**
冒号十六进制记法可以允许**零压缩** (zero compression)，即一连串连续的零可以为一对冒号所取代。
$FF05:0:0:0:0:0:0:B3$    可压缩为：    $FF05::B3$
**注意：在任一地址中只能使用一次零压缩。**
冒号十六进制记法可结合使用点分十进制记法的后缀，这种结合在 IPv4 向 IPv6 的转换阶段特别有用。
例如：0:0:0:0:0:0:128.10.2.1
    再使用零压缩即可得出：  ::128.10.2.1
==CIDR 的斜线表示法仍然可用。==
例如：60 位的前缀 12AB00000000CD3 可记为：
    12AB:0000:0000:CD30:0000:0000:0000:0000/60
	或 12AB::CD30:0:0:0:0/60 （零压缩）
	或 12AB:0:0:CD30::/60 （零压缩）
## 从IPv4 过渡到 IPv6
并非所有路由器都可以同时升级
- 没有 “标志日”
- 网络将如何与IPv4和IPv6混合路由器一起运行？
**隧道**：在IPv4路由器之间作为IPv4数据报中的有效载荷携带IPv6数据报（“数据包中的数据包”）
- 在其他情况下广泛使用的隧道（4G / 5G）
![image.png](https://picgo-1310230783.cos.ap-chengdu.myqcloud.com/obsidian/202306241601054.png)

